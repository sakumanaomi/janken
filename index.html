<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/sample.css">
  <title>じゃんけん</title>
 

</head>

<body>

  <header>
    <h1>じゃんけん</h1>
    <p><span id="DateTimeDisp"></span></p>
  </header>

  <main>
    <div id="section_janken">
    <!-- ジャンケンのボタン -->
    <ul class="janken">
      <!-- <li><img src="img/janken_gu.png" id="gu_btn" onClick="count()"></li> -->
      <li><img src="img/janken_gu.png" id="gu_btn" ></li>
      <li><img src="img/janken_choki.png" id="cho_btn" ></li>
      <li><img src="img/janken_pa.png" id="par_btn" ></li>
    </ul>

    <!-- PCが何を出したか -->
    <div class="pcBox">
      <div class="balloon2-right" id="balloon_txt">
        <p>こんにちは。
          <br> ジャンケン負けないぞ。
        </p>
      </div>
      <div class="">
        <!-- PC画面のイメージ -->
        <div class="PC_box1">
          <img src="img/PC.png" class="pcgamen" alt="">
        </div>
      </div>
      <!-- コンピュータの出した手 -->
      <div id="com_hand">
        <!-- <p>コンピュータの出した手は？音は？</p> -->
        <img id="hand" src="" alt="">
        <audio src="bgm/win.mp3" id="win-button"></audio>
        <audio src="bgm/more.mp3" id="more-button"></audio>
        <audio src="bgm/lose.mp3" id="lose-button"></audio>
      </div>
    </div>
    <!-- 勝ち負けの結果 -->
    <div id="result">結果は？</div>

    <p>ジャンケンの回数<span id="count">0</span>回</p>
    <p>あなたが勝った回数<span id="win">0</span>回</p>
    <P>勝率<span id="winrate"></span></P>

    <ul>
      <li id="save"> Save</li>
      <li id="clear">Clear</li>
    </ul>
    </div>
    <div id="section_byebye">
      <p>またね</p>
    </div>
  </main>

  <footer><span></span></footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script type="text/javascript">

    // ゲーム回数を数える
    let count = 0;
    let win = 0;
    winrate =0;

    // PCの出した手
    // グーぼたん
    let gameCount = 0;
    console.log(gameCount);
    $("#gu_btn").on("click", function () {
      gameCount += 1;
      const min = 0;
      const max = 2;
      const randomNumber = Math.floor((Math.random() * (max
        - min + 1)) + min);
      console.log(randomNumber);

      if (randomNumber === 0) {
        $("#result").text("あなたの勝ち");
        $("#hand").attr('src', "img/janken_choki.png");
        $("#win-button").get(0).play();
        count += 1;
        win += 1;
        winrate = Math.floor(win / count * 100);
        $("#winrate").text(winrate + "%");
        $('#count').text(count);
        $('#win').text(win);

      } else if (randomNumber === 1) {
        $("#result").text("あいこ");
        $("#hand").attr('src', "img/janken_gu.png");
        $("#more-button").get(0).play();
        count += 1;
        $('#count').text(count);
        winrate = Math.floor(win / count * 100);
        $("#winrate").text(winrate + "%");

      } else if (randomNumber === 2) {
        $("#result").text("あなたの負け");
        $("#hand").attr('src', "img/janken_pa.png");
        $("#lose-button").get(0).play();
        count += 1;
        $('#count').text(count);
        winrate = Math.floor(win / count * 100);
        $("#winrate").text(winrate + "%");

      } else {
        $("#result").text("error");
      }
    });

    // チョキボタン
    $("#cho_btn").on("click", function () {
      gameCount += 1;
      const min = 0;
      const max = 2;
      const randomNumber = Math.floor((Math.random() * (max
        - min + 1)) + min);
      console.log(randomNumber);

      if (randomNumber === 0) {
        $("#result").text("あなたの勝ち");
        $("#hand").attr('src', "img/janken_pa.png");
        $("#win-button").get(0).play();
        count += 1;
        win += 1;
        $('#count').text(count);
        $('#win').text(win);
        winrate = Math.floor(win / count * 100);
        $("#winrate").text(winrate + "%");

      } else if (randomNumber === 1) {
        $("#result").text("あいこ");
        $("#hand").attr('src', "img/janken_choki.png");
        $("#more-button").get(0).play();
        count += 1;
        $('#count').text(count);
        winrate = Math.floor(win / count * 100);
        $("#winrate").text(winrate + "%");

      } else if (randomNumber === 2) {
        $("#result").text("あなたの負け");
        $("#hand").attr('src', "img/janken_gu.png");
        $("#lose-button").get(0).play();
        count += 1;
        $('#count').text(count);
        winrate = Math.floor(win / count * 100);
        $("#winrate").text(winrate + "%");

      } else {
        $("#result").text("error");
      }
    });

    //パーボタン
    $("#par_btn").on("click", function () {
      gameCount += 1;
      const min = 0;
      const max = 2;
      const randomNumber = Math.floor((Math.random() * (max
        - min + 1)) + min);
      console.log(randomNumber);

      if (randomNumber === 0) {
        $("#result").text("あなたの勝ち");
        $("#hand").attr('src', "img/janken_gu.png");
        $("#win-button").get(0).play();
        count += 1;
        win += 1;
        $('#count').text(count);
        $('#win').text(win);
        winrate = Math.floor(win / count * 100);
        $("#winrate").text(winrate + "%");

      } else if (randomNumber === 1) {
        $("#result").text("あいこ");
        $("#hand").attr('src', "img/janken_pa.png");
        $("#more-button").get(0).play();
        count += 1;
        $('#count').text(count);
        winrate = Math.floor(win / count * 100);
        $("#winrate").text(winrate + "%");

      } else if (randomNumber === 2) {
        $("#result").text("あなたの負け");
        $("#hand").attr('src', "img/janken_choki.png");
        $("#lose-button").get(0).play();
        count += 1;
        $('#count').text(count);
        winrate = Math.floor(win / count * 100);
        $("#winrate").text(winrate + "%");

      } else {
        $("#result").text("error");
      }
    });

    //保存する処理    データ→ジェイソン形式→ローカルストレージへ
    $('#save').on('click',function(){
      const data = {                           //dataの
        result_count:$('#count').text(),       //result_countはジャンケンの回数、
        result_win: $('#win').text(),          //result_winは勝った回数にする
      }
      console.log(data);
      const jsonData = JSON.stringify(data);   //(data)をJSON形式にする
      console.log(jsonData);
      localStorage.setItem('memo', jsonData);  //keyはmemo、valueはjsonDataでローカルストレージに保存
    })

    // 保存されているデータを削除する処理   ローカルストレージの内容を消す→見た目も０にする
      $("#clear").on("click", function () {
        localStorage.removeItem('memo');       //keyから登録済みの文字列を削除
        count = 0;                             //変数のcountを０にする
        win = 0;                               //同じく
        winrate= 0;
        $('#count').text(count);               //<p>の中の勝った回数を表示する#countに上記のcountにする
        $('#win').text(win);                   //同じく
        $('#winrate').text(winrate);
      })

     // データが存在した場合は保存されているデータを取得して表示する処理   
      if (localStorage.getItem('memo')) {      //もしmemoのところのデータが取得できたら
        const jsonData = localStorage.getItem('memo');  //jsonDataにmemo keyからの値を取得
        console.log(jsonData);
        const data = JSON.parse(jsonData);      //jsonから戻す処理
        console.log(data);
        $('#count').text(data.result_count)     //dataのresult_countを取得
        $('#win').text(data.result_win)         //dataのresult_winを取得
      } 

     //更新しても前回保存のまま回数を重ねる処理（これがないと更新後ジャンケンすると０からカウントされるので）
      window.onload = function () {               
        // alert('更新')
        const jsonData = localStorage.getItem('memo');  //jsonDataにmemo keyからの値を取得
        console.log(jsonData);
        const data = JSON.parse(jsonData);          //jsonから戻す処理
        console.log(data);
        $('#count').text(data.result_count)         //dataのresult_countを取得
        $('#win').text(data.result_win)             //dataのtextプロパティの値の取得
        count = Number(data.result_count);           //元がtext文字列になっているのでNumberに
        win = Number(data.result_win);
      }

      const now = new Date();
      console.log(now)
      // function LoadProc() {
      const year = now.getFullYear();
      const month = now.getMonth() + 1;
      const date = now.getDate();
      const hour = now.getHours();
      const min = now.getMinutes();
      const output =year + "年" + month + "月" + date + "日" + hour +":"+min;
      console.log(output);
     document.getElementById("DateTimeDisp").innerHTML = output;
          // }

      // $(function(){
      // if('#count' >10){
      //   alert('そろそろ')
      // }
      // });     
  </script>

</body>

</html>